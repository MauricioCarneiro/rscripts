{
    "contents" : "require(\"ggplot2\")\n\nuncovered <- function(data, t) {\n  data_points = length(data$POS)\n  percent_uncovered <- length(data[data$AVG_INTERVAL_DP/12 < t,]$POS) / data_points\n  percent_uncovered * data_points\n}\n\nload_downsampled_datasets = function (filename) {\n  z <- data.frame()  \n  master <- cbind(\"100%\", read.delim(\"/humgen/gsa-hpprojects/dev/carneiro/clia/analysis/illumina_exome/cds/master_cds_gencodeV15.intervals.tbl\"))  \n  names(master) <- c(\"dataset\", names(master)[-1])\n  for (target in c(90, 80, 70, 60, 50, 40, 30, 25, 20, 17, 15, 12, 10)) {\n    tmp <- cbind(paste(target, \"%\", sep=\"\"), read.delim(paste(\"/humgen/gsa-hpprojects/dev/carneiro/clia/analysis/illumina_exome/downsample/down-0.\", target, \"/\", filename, sep = \"\")))\n    names(tmp) <- names(master)\n    master <- rbind(tmp, master)  \n    z <- rbind(z, c((target/100) * median(original$AVG_INTERVAL_DP/12), uncovered(tmp, 20)))\n  }\n  names(z) = c(\"ds\", \"uncovered\")\n  list(master, z)\n}\n\n\n## individual datasets\npre <- read.delim(\"/humgen/gsa-hpprojects/dev/carneiro/clia/analysis/illumina_exome/cds/no_mito_master_cds_gencodeV15.intervals.tbl\")\noriginal <- read.delim(\"/humgen/gsa-hpprojects/dev/carneiro/clia/analysis/illumina_exome/cds/master_cds_gencodeV15.intervals.d1.0.vcf.tbl\")\ncser <- read.delim(\"/humgen/gsa-hpprojects/dev/carneiro/clia/analysis/illumina_exome/cser-genetest/GeneTest-transcripts-130221.intervals.vcf.tbl\")\ncanseq <- read.delim(\"/humgen/gsa-hpprojects/dev/carneiro/clia/analysis/illumina_exome/cancer/canseq_genes.tbl\")\nffpe <- read.delim(\"/humgen/gsa-hpprojects/dev/carneiro/clia/analysis/illumina_exome/ffpe/master_cds_gencodeV15.intervals.d1.0.vcf.tbl\")\ntissue_cells <- read.delim(\"/humgen/gsa-hpprojects/dev/carneiro/clia/analysis/illumina_exome/tissue_cells/master_cds_gencodeV15.intervals.d1.0.vcf.tbl\")\ntrio <- read.delim(\"/humgen/gsa-hpprojects/dev/carneiro/clia/analysis/illumina_exome/trio/master_cds_gencodeV15.intervals.d1.0.vcf.tbl\")\ntumor <- read.delim(\"/humgen/gsa-hpprojects/dev/carneiro/clia/analysis/illumina_exome/tumor_normal/master_cds_gencodeV15.intervals.d1.0.vcf.tbl\")\nnormal <- read.delim(\"/humgen/gsa-hpprojects/dev/carneiro/clia/analysis/illumina_exome/tumor_normal/normal/master_cds_gencodeV15.intervals.d1.0.vcf.tbl\")\n\n\ndx <- original\nnsamples <- 2\nmedian(dx$AVG_INTERVAL_DP/nsamples)\nuncovered(dx, 20)\nuncovered(dx, 20) * 72072\nqplot(AVG_INTERVAL_DP/nsamples, data=dx, xlim=c(0,750), geom=\"density\", fill=\"red\", xlab=\"Average depth per sample\", ylab=\"% targets\") + geom_vline(xintercept=20, linetype=\"dashed\") + scale_fill_discrete(guide = \"none\")\n\n\n#qplot(FILTER, data=subset(dx, FILTER != \"PASS\")) + theme(axis.text.x = element_text(angle=90, hjust=1))\n\n\n#Downsampled datasets\nx = load_downsampled_datasets(\"master_cds_gencodeV15.intervals.vcf.tbl\")\nd = x[[1]]\nz = x[[2]]\nrm(x)\n\nuncovered(d=subset(d, dataset==\"10%\"), 20)\nuncovered(d=subset(d, dataset==\"20%\"), 20)\nuncovered(d=subset(d, dataset==\"30%\"), 20)\nuncovered(d=subset(d, dataset==\"40%\"), 20)\nuncovered(d=subset(d, dataset==\"50%\"), 20)\nuncovered(d=subset(d, dataset==\"60%\"), 20)\nuncovered(d=subset(d, dataset==\"70%\"), 20)\nuncovered(d=subset(d, dataset==\"80%\"), 20)\nuncovered(d=subset(d, dataset==\"90%\"), 20)\n\nqplot(AVG_INTERVAL_DP/12, data=subset(d, dataset==\"10%\" | dataset==\"20%\" | dataset==\"30%\" | dataset==\"40%\" | dataset==\"50%\"| dataset==\"60%\" | dataset==\"70%\" | dataset ==\"80%\" | dataset == \"90%\" | dataset == \"100%\"), geom=\"density\", fill=dataset, alpha=0.1, group=dataset, xlab=\"Average depth per target\", ylab=\"% targets\", xlim = c(0, 600)) + geom_vline(xintercept=20, linetype=\"dashed\") + scale_alpha(guide=\"none\") + scale_fill_hue(name=\"target coverage\", labels=signif(seq(0.1, 1, 0.1) * median(original$AVG_INTERVAL_DP/12), digits=2))\nqplot(ds, uncovered, data=z, ylab=\"# targets under 20x coverage\", xlab=\"target median coverage\") + geom_smooth()",
    "created" : 1365039994737.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3447971646",
    "id" : "1439AC92",
    "lastKnownWriteTime" : 1366049244,
    "path" : "~/Dropbox/src/tdplots/clia_truseq_coverage_analysis.r",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}